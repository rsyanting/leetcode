# 98_ValidateBinarySearchTree_éªŒè¯æœç´¢äºŒå‰æ ‘

## ğŸ“Œé¢˜ç›®è¯¦æƒ…

[leetcode é¢˜ç›®åœ°å€](https://leetcode.com/problems/validate-binary-search-tree/)

[leetcode-cn é¢˜ç›®åœ°å€](https://leetcode-cn.com/problems/validate-binary-search-tree/)

ğŸ“—Difficultyï¼š**Medium** 	

ğŸ¯Tagsï¼š

+ **[Recursion](https://leetcode.com/tag/recursion/)**
+ **[Tree](https://leetcode.com/tag/tree/)**
+ [depth-first-search](https://leetcode.com/tag/depth-first-search/)

## ğŸ“ƒé¢˜ç›®æè¿°ï¼š

ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚

å‡è®¾ä¸€ä¸ªäºŒå‰æœç´¢æ ‘å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š

èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å«å°äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚
èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å«å¤§äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚
æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚

**æ ·ä¾‹ 1ï¼š**

```
è¾“å…¥:
    2
   / \
  1   3
è¾“å‡º: true
```



**æ ·ä¾‹ 2ï¼š**

```
è¾“å…¥:
    5
   / \
  1   4
Â     / \
Â    3   6
è¾“å‡º: false
è§£é‡Š: è¾“å…¥ä¸º: [5,1,4,null,null,3,6]ã€‚
Â     æ ¹èŠ‚ç‚¹çš„å€¼ä¸º 5 ï¼Œä½†æ˜¯å…¶å³å­èŠ‚ç‚¹å€¼ä¸º 4 ã€‚
```

****

## ğŸ¹ğŸ¯è§£é¢˜æ€è·¯

### ä¸­åºéå† é€’å½’

```java
class Solution {
    long pre = Long.MIN_VALUE;
    public boolean isValidBST(TreeNode root) {
        if (root == null) {
            return true; // æ³¨æ„æ­¤å¤„æ¡ä»¶
        }
        // è®¿é—®å·¦å­æ ‘
        if (!isValidBST(root.left)) {
            return false;
        }
        // è®¿é—®å½“å‰èŠ‚ç‚¹ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹çš„å€¼å°äºç­‰äºä¸­åºéå†çš„å‰ä¸€ä¸ªèŠ‚ç‚¹å€¼ï¼Œä¸æ»¡è¶³äºŒå‰æœç´¢æ ‘ç‰¹æ€§ï¼ˆBSTï¼‰ï¼Œè¿” false
        if (root.val <= pre) {
            return false;
        }
        pre = root.val;
        // è®¿é—®å³å­æ ‘
        return isValidBST(root.right);
    }
}
```

#### å¤æ‚åº¦åˆ†æ

+ æ—¶é—´å¤æ‚åº¦ï¼šO(n)ã€‚äºŒå‰æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šè¢«è®¿é—® 1 æ¬¡ã€‚
+ ç©ºé—´å¤æ‚åº¦ï¼š



### ä¸­åºéå† éé€’å½’ç‰ˆ

```java
public boolean isValidBST(TreeNode root) {
    Stack<TreeNode> stack = new Stack<>();
    long inorderValue = Long.MIN_VALUE;

    while (!stack.isEmpty() || root != null) {
        while (root != null) {
            stack.push(root);
            root = root.left;
        }
        root = stack.pop();
        if (root.val <= inorderValue) {
            return false;
        }
        inorderValue = root.val;
        root = root.right;
    }
    return true;
}
```

#### ä¸¾ä¾‹ï¼š

##### å½“æ ‘ä¸ºæ ·ä¾‹ 1 æ—¶ï¼š

+ é¦–å…ˆè¿›å…¥ç¬¬ä¸€å±‚ `while` å¾ªç¯ï¼Œè¿›å…¥ç¬¬äºŒå±‚ `while` å¾ªç¯ï¼Œä¾æ¬¡å‹å…¥èŠ‚ç‚¹ `2ï¼Œ1`ï¼Œéšåå¼¹æ ˆï¼Œroot ä¸ºèŠ‚ç‚¹ 1ã€‚ç¬¬ä¸€ä¸ªè¢«è®¿é—®åˆ°çš„å…ƒç´ è‚¯å®šä¸å°äº `inorderValue` çš„æœ€å°å€¼ï¼Œå°† `inorderValue` çš„å€¼æ›´æ–°ä¸ºå½“å‰ root çš„ valï¼Œå³ 1ã€‚æ›´æ–° root ä¸ºå…¶å³å­æ ‘èŠ‚ç‚¹ã€‚
+ æ ˆä¸ç©ºï¼Œæ­¤æ—¶ root ä¸º nullã€‚å¼¹æ ˆï¼Œroot æ­¤æ—¶ä¸º 2ã€‚å³åŸæœ¬çš„æ ¹èŠ‚ç‚¹ã€‚å…¶å€¼ä¸å°äº `inorderValue` çš„å€¼ï¼Œæ›´æ–° `inorderValue` å€¼ä¸º 2ã€‚root æ›´æ–°ä¸ºå…¶å³å­æ ‘èŠ‚ç‚¹ï¼Œå³èŠ‚ç‚¹å€¼ä¸º 3 çš„èŠ‚ç‚¹ã€‚
+ æ ˆç©ºï¼Œå½“ root ä¸ä¸º nullã€‚è¿›å…¥ç¬¬äºŒå±‚ `while` å¾ªç¯ï¼Œå‹æ ˆï¼Œæ­¤æ—¶æ ˆä¸­æœ‰å…ƒç´  3 çš„èŠ‚ç‚¹ã€‚å¼¹æ ˆï¼Œroot æ­¤æ—¶ä¸ºèŠ‚ç‚¹å€¼ 3 çš„èŠ‚ç‚¹ã€‚å…¶ä¸å°äº `inorderValue` çš„å€¼ 2 ï¼Œæ›´æ–° `inorderValue` å€¼ä¸º 3ã€‚root æ›´æ–°ä¸ºèŠ‚ç‚¹ 3 çš„å³å­æ ‘ã€‚**æ­¤æ—¶ï¼Œæ ˆç©ºï¼Œroot å€¼ä¸º nullã€‚**
+ ç¬¬ä¸€å±‚ `while` å¾ªç¯ç»“æŸï¼Œè¿”å› `true`ã€‚

##### å½“æ ‘ä¸ºæ ·ä¾‹ 2 æ—¶ï¼š

+ é¦–å…ˆè¿›å…¥ç¬¬ä¸€å±‚ `while` å¾ªç¯ï¼Œè¿›å…¥ç¬¬äºŒå±‚ `while` å¾ªç¯ï¼Œä¾æ¬¡å‹å…¥èŠ‚ç‚¹ `5ï¼Œ1`ï¼Œéšåå¼¹æ ˆï¼Œroot ä¸ºèŠ‚ç‚¹ 1ã€‚ç¬¬ä¸€ä¸ªè¢«è®¿é—®åˆ°çš„å…ƒç´ è‚¯å®šä¸å°äº `inorderValue` çš„æœ€å°å€¼ï¼Œå°† `inorderValue` çš„å€¼æ›´æ–°ä¸ºå½“å‰ root çš„ valï¼Œå³ 1ã€‚æ›´æ–° root ä¸ºå…¶å³å­æ ‘èŠ‚ç‚¹ã€‚
+ æ ˆä¸ç©ºï¼Œæ­¤æ—¶ root ä¸º nullã€‚å¼¹æ ˆï¼Œroot æ­¤æ—¶ä¸º 5ã€‚å³åŸæœ¬çš„æ ¹èŠ‚ç‚¹ã€‚å…¶å€¼ä¸å°äº`inorderValue` çš„å€¼ï¼Œæ›´æ–° `inorderValue` å€¼ä¸º 5ã€‚root æ›´æ–°ä¸ºå…¶å³å­æ ‘èŠ‚ç‚¹ï¼Œå³èŠ‚ç‚¹å€¼ä¸º 4çš„èŠ‚ç‚¹ã€‚
+ æ ˆç©ºï¼Œå½“ root ä¸ä¸º nullã€‚è¿›å…¥ç¬¬äºŒå±‚ `while` å¾ªç¯ï¼Œå‹æ ˆï¼Œæ­¤æ—¶æ ˆä¸­æœ‰å…ƒç´  `4ï¼Œ3` çš„èŠ‚ç‚¹ã€‚å¼¹æ ˆï¼Œroot æ­¤æ—¶ä¸ºèŠ‚ç‚¹å€¼ 3 çš„èŠ‚ç‚¹ã€‚**å…¶å°äº `inorderValue` çš„å€¼ 5** ï¼Œè¿”å› `false` ã€‚

#### å¤æ‚åº¦åˆ†æ

+ æ—¶é—´å¤æ‚åº¦ï¼šO(n)ã€‚äºŒå‰æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šè¢«è®¿é—® 1 æ¬¡ã€‚
+ ç©ºé—´å¤æ‚åº¦ï¼šO(n)ã€‚stack ä¸­æœ€å¤šå­˜å‚¨ n ä¸ªèŠ‚ç‚¹ã€‚ï¼ˆæ­¤æ—¶å…¨éƒ¨ä¸ºå·¦å­æ ‘ã€‚é€€åŒ–æˆé“¾è¡¨ã€‚ï¼‰

---

### é€’å½’ç®—æ³•

è¦è§£å†³è¿™é“é¢˜é¦–å…ˆæˆ‘ä»¬è¦äº†è§£äºŒå‰æœç´¢æ ‘æœ‰ä»€ä¹ˆæ€§è´¨å¯ä»¥ç»™æˆ‘ä»¬åˆ©ç”¨ï¼Œç”±é¢˜ç›®ç»™å‡ºçš„ä¿¡æ¯æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š**å¦‚æœè¯¥äºŒå‰æ ‘çš„å·¦å­æ ‘ä¸ä¸ºç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼› è‹¥å®ƒçš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼›å®ƒçš„å·¦å³å­æ ‘ä¹Ÿä¸ºäºŒå‰æœç´¢æ ‘ã€‚**

è¿™å¯ç¤ºæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªé€’å½’å‡½æ•° `helper(root, lower, upper)` æ¥é€’å½’åˆ¤æ–­ï¼Œå‡½æ•°è¡¨ç¤ºè€ƒè™‘ä»¥ `root` ä¸ºæ ¹çš„å­æ ‘ï¼Œåˆ¤æ–­å­æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å€¼æ˜¯å¦éƒ½åœ¨ `(l,r)` çš„èŒƒå›´å†…ï¼ˆæ³¨æ„æ˜¯å¼€åŒºé—´ï¼‰ã€‚å¦‚æœ `root` èŠ‚ç‚¹çš„å€¼ `val` ä¸åœ¨ `(l,r)` çš„èŒƒå›´å†…è¯´æ˜ä¸æ»¡è¶³æ¡ä»¶ç›´æ¥è¿”å›ï¼Œå¦åˆ™æˆ‘ä»¬è¦ç»§ç»­é€’å½’è°ƒç”¨æ£€æŸ¥å®ƒçš„å·¦å³å­æ ‘æ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœéƒ½æ»¡è¶³æ‰è¯´æ˜è¿™æ˜¯ä¸€æ£µäºŒå‰æœç´¢æ ‘ã€‚

é‚£ä¹ˆæ ¹æ®äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ï¼Œåœ¨é€’å½’è°ƒç”¨å·¦å­æ ‘æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä¸Šç•Œ `upper` æ”¹ä¸º `root.val`ï¼Œå³è°ƒç”¨ `helper(root.left, lower, root.val)`ï¼Œå› ä¸ºå·¦å­æ ‘é‡Œæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ã€‚åŒç†é€’å½’è°ƒç”¨å³å­æ ‘æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä¸‹ç•Œ `lower` æ”¹ä¸º `root.val`ï¼Œå³è°ƒç”¨ `helper(root.right, root.val, upper)`ã€‚



ä¸ºä»€ä¹ˆéœ€è¦åŠ å…¥ä¸Šä¸‹ç•Œå‘¢ï¼Ÿ

![å‡çš„ BST çš„æƒ…å†µ](https://assets.ryantech.ltd/20200807145447.png)

å¯¹äºä¸Šé¢ç»™å®šçš„å›¾ç‰‡ä¸­çš„æƒ…å†µï¼Œå¦‚æœæ²¡æœ‰å¸¦å…¥ä¸Šä¸‹ç•Œï¼Œå°±ä¼šé—æ¼æ‰ BST çš„å®šä¹‰ä¸­çš„æŸäº›å®šä¹‰ï¼Œé€ æˆé”™è¯¯ã€‚é”™è¯¯çš„ä»£ç å¦‚ä¸‹ï¼š

```java
boolean isValidBST(TreeNode root) {
    if (root == null) return true;
    if (root.left != null && root.val <= root.left.val) return false;
    if (root.right != null && root.val >= root.right.val) return false;

    return isValidBST(root.left)
        && isValidBST(root.right);
}
```



#### æ­£ç¡®çš„ä»£ç 

```java
// é€ä¸ªå­æ ‘åˆ¤æ–­ä¸Šä¸‹ç•Œçš„æ–¹æ³•
public boolean helper(TreeNode node, Integer lower, Integer upper) {
    if (node == null) return true;

    int val = node.val;
    // æ ¹æ® BST çš„å®šä¹‰ï¼š
    // èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å«å°äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚
    // èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å«å¤§äºå½“å‰èŠ‚ç‚¹çš„æ•°ã€‚
    // å¦‚æœä¸ç¬¦åˆï¼Œåˆ™è¿”å› false
    if (lower != null && val <= lower) return false;
    if (upper != null && val >= upper) return false;

    // é€’å½’çš„è¿›è¡Œåˆ¤æ–­
    if (!helper(node.left, lower, val)) return false; // é¦–å…ˆåˆ¤æ–­å·¦å­æ ‘
    return helper(node.right, val, upper); // å†åˆ¤æ–­å³å­æ ‘
}

public boolean isValidBST(TreeNode root) {
    return helper(root, null, null);
}
```



#### å¤æ‚åº¦åˆ†æ

+ æ—¶é—´å¤æ‚åº¦ï¼š`O(n)`ã€‚äºŒå‰æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šè¢«è®¿é—® `1` æ¬¡ã€‚
+ ç©ºé—´å¤æ‚åº¦ï¼š`O(n)`ã€‚æ ‘é€€åŒ–æˆé“¾è¡¨ã€‚

---

## ğŸ’¡æ€»ç»“ï¼š

äºŒå‰æ ‘çš„éå†ï¼Œæ˜¯äºŒå‰æ ‘é¢˜ç›®çš„åŸºç¡€ã€‚

å…¶ 2 ç§æ–¹å¼ï¼Œåˆ†åˆ«ä¸º **é€’å½’å½¢å¼** å’Œ **éé€’å½’å½¢å¼**ï¼ˆä½¿ç”¨ stack æ¥è¾…åŠ©ï¼‰ï¼Œæ˜¯éå¸¸é‡è¦çš„åŸºç¡€çŸ¥è¯†ã€‚

